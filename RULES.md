# Usage Rules - SAS Job Execution Web Application

This repository gathers best practices and technical requirements for developing applications with the SAS Job Execution Web Application, focusing on security, compatibility, and standardization within corporate environments.

## ✅ Execution Requirements

### 1. Environment with HTTPS and a Valid Certificate

- The execution environment must be under a domain with a valid SSL/TLS certificate.

### 2. Use of Plain HTML, CSS, and JavaScript

- It is recommended to use standard technologies (Vanilla JavaScript, CSS3, and HTML5).
- Some frameworks may be used as long as they are embedded locally (see item 3).

### 3. External CDNs Are Not Allowed (Security Restriction)

- In environments using SAS Job Execution Services (JES), external links (CDNs, fonts, libraries) are not permitted.
- **Solution:** download the JS and CSS files and reference them locally in the job (see item 4).

### 4. Reference Files Locally

- The SAS path structure does not follow the traditional web development conventions. It is not possible to reference files using only the file name or relative paths as shown below:

```html
<script src="script.js"></script>
<link rel="stylesheet" href="style.css">
```

- **Solution:** it is necessary to use the **URI** generated by SAS and append `/content` at the end of the file. Example:

```html
<script src="/file/file/{URI}/content"></script>
<link rel="stylesheet" href="/file/file/{URI}/content">
```

> [!TIP]
> If you're not sure how to obtain the URI of a file, see the [tutorial on obtaining the URI of a file](/tutoriais/coletar_URI_do_arquivo.md) for the full instructions!

### 5. Validation and Logging Logic

- Always validate the parameters received by the job, especially when sent via HTML/JS interfaces.
- Use logs and messages with `%put` for execution tracking.
- Create macros to capture and handle errors during the SAS execution flow.

### 6. SAS Environment Configuration

Throughout various developments I've done, I noticed that certain standard configurations are necessary to run **SAS Job Execution** smoothly in the environment. These modifications include:

#### Configuration in SAS Visual Analytics

- Access the **SAS Provider** environment (it must not be a *tenant*).
- Go to the **SAS® Environment Manager** microservice.
- Navigate to **Configuration**, then **View**, and click on **Definitions**.
- In the filter, select the term **sas.visualanalytics**.
- Edit the **IFrame Sandbox Attribute Value** option and add the following commands:

```plaintext
allow-scripts allow-downloads allow-popups allow-modals
```

This configuration will allow you to run **SAS JE** inside **SAS VA**.

#### Configuration for CSS and JS in SAS Job Execution

- Access the **SAS Provider** environment (must not be a *tenant*).
- Go to the **SAS® Environment Manager**.
- Navigate to **Configuration**, then **View**, and click on **Definitions**.
- In the filter, select the term **sas.commons.web.security**.
- Edit the **Files service** option, go to the **content-security-policy** setting, and configure it as follows:

```plaintext
default-src *; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src * blob: data:; child-src * blob: data: mailto:;frame-src * blob: data: mailto:;
```

- Do the same for the **SAS Drive**, **SAS Visual Analytics**, and **SAS Visual Investigator** options.

This configuration allows **SAS JE** to execute CSS and JS files.